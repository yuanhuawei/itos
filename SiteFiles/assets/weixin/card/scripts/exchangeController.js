var controller={};controller.poweredBy="",controller.isLoading=!0,controller.isSuccess=!1,controller.isPoweredBy=!1,controller.exchangeProportion="",controller.userInfo={},controller.cardInfo={},controller.cardSNInfo={},controller.render=function(){utilService.render("controller",controller),$("#credits").blur(function(){if(/^(\+)?\d+$/.test($(this).val())){if($.trim($(this).val()).length>0)if("0"==$(this).val())notifyService.error("兑换积分大于0"),$(this).val("");else{var r=parseInt($.trim($(this).val()));if(controller.userInfo.credits<r)notifyService.error("兑换积分大于可用积分"),$(this).val("");else{var e=r/parseFloat(controller.exchangeProportion);$("#amount").val(e)}}}else notifyService.error("请输入正确的兑换积分"),$(this).val("")}),$("#btnSubmit").click(function(){controller.Exchange()}),$("#loading").hide(),$("#main").show()},controller.Exchange=function(){var r=$("#credits").val();return r.length<=0?(notifyService.error("兑换积分不能为空"),void $("#credits").focus()):isNaN(r)?(notifyService.error("请输入正确的兑换积分"),void $("#credits").focus()):void service.exchange(service.cardID,r,function(r){controller.isSuccess=r.isSuccess,controller.isSuccess?(controller.render(),r.errorMessage.length>0?notifyService.error(r.errorMessage):service.openMyCard()):notifyService.error(r.errorMessage)})},controller.main=function(){service.getCardParameter(service.cardID,function(r){controller.isLoading=!1,r.isSuccess?(controller.isPoweredBy=r.isPoweredBy,controller.poweredBy=r.poweredBy,controller.userInfo=r.userInfo,controller.cardInfo=r.cardInfo,controller.cardSNInfo=r.cardSNInfo,controller.exchangeProportion=r.exchangeProportion,controller.render()):notifyService.error(r.errorMessage),document.title=r.cardInfo.title})},controller.main();