var controller={};controller.isLoading=!0,controller.isPoweredBy=!1,controller.poweredBy="",controller.collectInfo={},controller.itemList=[],controller.itemInfo={},controller.votedItemIDCollection="",controller.itemIDCollectionWithRank=[],controller.render=function(){utilService.render("controller",controller),service.itemID?($(".j_tp_btn").click(function(){$(".mark_fixed").show(),$(".share_img").show()}),$(".mark_fixed, .share_img").click(function(){$(".mark_fixed").hide(),$(".share_img").hide()})):$("#upload").length>0&&new AjaxUpload("upload",{action:service.getUploadUrl(),name:"Upload",data:{},onSubmit:function(e,r){var o=/^(jpg|jpeg|png|gif)$/i;if(!r||!o.test(r))return notifyService.error("只允许上传JPG,PNG,GIF图片"),!1},onComplete:function(e,r){r&&(r=$.parseJSON($(r).text()),r.isSuccess?($("#preview_imageUrl").attr("src",r.largeUrl),$("#largeUrl").val(r.largeUrl),$("#smallUrl").val(r.smallUrl)):notifyService.error(r.errorMessage))}}),$("#loading").hide(),$("#main").show()},controller.main=function(){service.getCollectParameter(function(e){if(controller.isLoading=!1,e.isSuccess)if(e.isEnd)service.redirectToEnd();else{for(controller.isPoweredBy=e.isPoweredBy,controller.poweredBy=e.poweredBy,controller.votedItemIDCollection=e.votedItemIDCollection,controller.itemIDCollectionWithRank=e.itemIDCollectionWithRank,controller.collectInfo=e.collectInfo,controller.itemList=e.itemList,i=0;i<controller.itemList.length;i++){var r=controller.itemList[i];service.itemID==r.id&&(controller.itemInfo=r)}controller.render()}else notifyService.error(e.errorMessage);document.title=e.collectInfo.title})},controller.main(),controller.isVoted=function(e){if(controller.votedItemIDCollection){var r=JSON.parse("["+controller.votedItemIDCollection+"]");if(r&&r.indexOf(e)!=-1)return!0}return!1},controller.getRank=function(e){if(controller.itemIDCollectionWithRank)for(i=0;i<controller.itemIDCollectionWithRank.length;i++){var r=controller.itemIDCollectionWithRank[i],o=JSON.parse("["+r.itemIDCollection+"]");if(o&&o.indexOf(e)!=-1)return r.rank}return 0},controller.submitUpload=function(){var e=$("#title").val(),r=$("#description").val(),o=$("#mobile").val(),i=$("#smallUrl").val(),t=$("#largeUrl").val();return e?r?o?i&&t?($("#loading").show(),$("#main").hide(),void service.submitUpload(e,r,o,i,t,function(e){e.isSuccess?e.isCheck?(notifyService.success("恭喜，提交已成功，我们将尽快审核您的参赛信息"),setTimeout(function(){service.redirectToIndex()},1e3)):(notifyService.success("恭喜，提交已成功，系统将跳转至您的参赛页面"),setTimeout(function(){service.redirectToItem(e.itemID)},1e3)):(notifyService.error(e.errorMessage),$("#main").show(),$("#loading").hide())})):void notifyService.error("操作失败，请上传照片"):(notifyService.error("操作失败，请填写手机号码"),void $("#mobile").focus()):(notifyService.error("操作失败，请填写参赛宣言"),void $("#description").focus()):(notifyService.error("操作失败，请填写标题"),void $("#title").focus())},controller.submitVote=function(e){return controller.isVoted(e)?void notifyService.error("您已投票，可以分享到朋友圈为TA拉票"):($("#loading").show(),$("#main").hide(),void service.submitVote(e,function(e){e.isSuccess?(notifyService.success("投票成功，感谢您的参与"),setTimeout(function(){service.itemID?service.redirectToItem(service.itemID):service.redirectToVote()},1e3)):(notifyService.error(e.errorMessage),controller.render())}))};