function isPc(){for(var e=navigator.userAgent,o=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],t=!0,r=0;r<o.length;r++)if(e.indexOf(o[r])>0){t=!1;break}return t}function ChoseVoteType(e){e.checked?$("#VoteUserNameDiv").css("display",""):$("#VoteUserNameDiv").css("display","none")}function IsPC(){for(var e=navigator.userAgent,o=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],t=!0,r=0;r<o.length;r++)if(e.indexOf(o[r])>0){t=!1;break}return t}var controller={};controller.isLoading=!0,controller.voteID=utilService.getUrlVar("voteID"),controller.wxOpenID=utilService.getUrlVar("wxOpenID"),controller.uniqueID=utilService.getUrlVar("uniqueID"),controller.from=utilService.getUrlVar("from"),controller.isPoweredBy=!1,controller.poweredBy="",controller.isVoted=!1,controller.totalVoteNum=0,controller.voteInfo={},controller.itemList=[],controller.itemIDCollection="",controller.openCheck=function(){location.href="text.html?voteID="+controller.voteID+"&publishmentSystemID="+service.publishmentSystemID+"&wxOpenID="},controller.render=function(){utilService.render("controller",controller),$(".col-xs-12").click(function(){controller.voteInfo.contentIsCheckBox?$(this).toggleClass("title_list_H"):$(this).addClass("title_list_H").siblings().removeClass("title_list_H").end()}),$(".col-md-12").click(function(){controller.voteInfo.contentIsCheckBox?$(this).toggleClass("img-thumbnail-H"):$(this).addClass("img-thumbnail-H").siblings().removeClass("img-thumbnail-H").end()}),$("#loading").hide(),$("#main").show()},controller.Auth=function(){var e="WeixinMob",o=location.href,t="http://gexia.com/home/authlogin.html?isWeixin=true&loginType="+e+"&returnUrl="+o;location.href=t},controller.main=function(){""!=controller.from&&controller.openCheck(),(""!=controller.uniqueID||isPc())&&(controller.wxOpenID=controller.uniqueID),service.getVoteParameter(controller.voteID,controller.wxOpenID,function(e){if(controller.isLoading=!1,e.isSuccess)if(e.isEnd)location.href="end.html?voteID="+controller.voteID+"&publishmentSystemID="+service.publishmentSystemID+"&wxOpenID="+controller.wxOpenID;else{for(controller.isPoweredBy=e.isPoweredBy,controller.poweredBy=e.poweredBy,controller.isVoted=e.isVoted,controller.voteInfo=e.voteInfo,controller.itemList=e.itemList,controller.totalVoteNum=0,i=0;i<controller.itemList.length;i++){var o=controller.itemList[i];controller.totalVoteNum+=o.voteNum}controller.render()}else notifyService.error(e.errorMessage);document.title=e.voteInfo.title})},controller.main(),controller.getPercentage=function(e){return 0==controller.totalVoteNum&&(controller.totalVoteNum=1),Math.round(e/controller.totalVoteNum*100)+"%"},controller.isItem=function(e){if(controller.itemIDCollection){var o=JSON.parse("["+controller.itemIDCollection+"]");if(o&&o.indexOf(e)!=-1)return!0}return!1},controller.submitVote=function(){if(controller.itemIDCollection="",$(".title_list_H,.img-thumbnail-H").each(function(e,o){controller.itemIDCollection+=$(o).attr("itemID")+","}),!controller.itemIDCollection)return void notifyService.error("操作失败，请至少选择一个项目进行投票");controller.itemIDCollection=controller.itemIDCollection.substring(0,controller.itemIDCollection.length-1);var e=$("#userName").val();$("#loading").show(),$("#main").hide();var o=IsPC();service.submitVote(controller.voteID,controller.wxOpenID,controller.itemIDCollection,e,o,function(e){if(e.isSuccess){for(controller.isVoted=!0,controller.itemList=e.itemList,controller.totalVoteNum=0,i=0;i<controller.itemList.length;i++){var o=controller.itemList[i];controller.totalVoteNum+=o.voteNum}notifyService.success("投票成功，感谢您的参与")}else notifyService.error(e.errorMessage);controller.render()})};