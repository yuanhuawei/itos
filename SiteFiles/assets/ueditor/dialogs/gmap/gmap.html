<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> <title></title> <script type="text/javascript" src="../internal.js"></script><style type="text/css">.content{width:530px;height:350px;margin:10px auto}.content table{width:100%}.content table td{vertical-align:middle}#address{width:220px;height:21px;background:#FFF;border:1px solid #d7d7d7;line-height:21px}</style><script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=false"></script></head><body> <div class="content"> <table> <tr> <td><label for="address"><var id="lang_input_address"></var></label></td> <td><input id="address" type="text"></td> <td><a id="doSearch" href="javascript:void(0)" class="button"><var id="lang_input_search"></var></a></td> </tr> </table> <div id="container" style="width:100%;height:340px;margin:5px auto;border:1px solid gray"></div> </div> <script type="text/javascript">domUtils.on(window,"load",function(){function e(){var e=document.getElementById("address").value,o=new google.maps.Geocoder;o.geocode({address:e},function(o,t){if(t==google.maps.GeocoderStatus.OK){var s=o[0].geometry.viewport;a.fitBounds(s),n.setPosition(o[0].geometry.location),n.setTitle(e)}else alert(lang.searchError)})}function o(e,o){var t=new RegExp(o+"=((\\d+|[.,])*)","g");return t.exec(e)[1]}var t,a=new google.maps.Map(document.getElementById("container"),{zoom:3,streetViewControl:!1,scaleControl:!0,mapTypeId:google.maps.MapTypeId.ROADMAP}),n=new google.maps.Marker({map:a,draggable:!0});$G("address").onkeydown=function(o){o=o||event,13==o.keyCode&&e()},$G("doSearch").onclick=e,dialog.onok=function(){var e=a.getCenter(),o=n.getPosition(),s="http://maps.googleapis.com/maps/api/staticmap?center="+e.lat()+","+e.lng()+"&zoom="+a.zoom+"&size=520x340&maptype="+a.getMapTypeId()+"&markers="+o.lat()+","+o.lng()+"&sensor=false";editor.execCommand("inserthtml",'<img width="520" height="340" src="'+s+'"'+(t?' style="'+t+'"':"")+"/>")};var s=editor.selection.getRange().getClosedNode();if(s&&-1!=s.src.indexOf("http://maps.googleapis.com/maps/api/staticmap")){var r=s.getAttribute("src"),i=o(r,"center").split(",");point=new google.maps.LatLng(Number(i[0]),Number(i[1])),a.setCenter(point),a.setZoom(Number(o(r,"zoom"))),i=o(r,"markers").split(","),n.setPosition(new google.maps.LatLng(Number(i[0]),Number(i[1]))),t=s.style.cssText}else setTimeout(function(){e()},30)});</script></body></html>