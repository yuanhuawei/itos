<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> <title></title> <script type="text/javascript" src="../internal.js"></script><script type="text/javascript" src="http://api.map.baidu.com/api?v=1.1&services=true"></script><style type="text/css">.content{width:530px;height:350px;margin:10px auto}.content table{width:100%}.content table td{vertical-align:middle}#city,#address{height:21px;background:#FFF;border:1px solid #d7d7d7;line-height:21px}#city{width:60px}#address{width:130px}#is_dynamic_label span{vertical-align:middle;margin:3px 0 3px 3px}#is_dynamic_label input{vertical-align:middle;margin:3px 3px 3px 50px}</style></head><body> <div class="content"> <table> <tr> <td><var id="lang_city"></var>:</td> <td><input id="city" type="text"></td> <td><var id="lang_address"></var>:</td> <td><input id="address" type="text" value=""></td> <td><a href="javascript:doSearch()" class="button"><var id="lang_search"></var></a></td> <td><label id="is_dynamic_label" for="is_dynamic"><input id="is_dynamic" type="checkbox" name="is_dynamic"><span><var id="lang_dynamicmap"></var></span></label></td> </tr> </table> <div style="width:100%;height:340px;margin:5px auto;border:1px solid gray" id="container"></div> </div> <script type="text/javascript">function doSearch(){if(!document.getElementById("city").value)return void alert(lang.cityMsg);var e=new BMap.LocalSearch(document.getElementById("city").value,{onSearchComplete:function(e){if(e&&e.getNumPois()){for(var t=[],a=0;a<e.getCurrentNumPois();a++)t.push(e.getPoi(a).point);t.length>1?map.setViewport(t):map.centerAndZoom(t[0],13),point=map.getCenter(),marker.setPoint(point)}else alert(lang.errorMsg)}});e.search(document.getElementById("address").value||document.getElementById("city").value)}function getPars(e,t){var a=new RegExp(t+"=((\\d+|[.,])*)","g");return a.exec(e)[1]}function init(){var e=editor.selection.getRange().getClosedNode(),t=e&&/api[.]map[.]baidu[.]com/gi.test(e.getAttribute("src")),a=e&&domUtils.hasClass(e,"ueditor_baidumap");if(t||a){var r,n,o;a?(r=decodeURIComponent(e.getAttribute("src")),$G("is_dynamic").checked=!0,styleStr=e.style.cssText):(r=e.getAttribute("src"),styleStr=e.style.cssText),n=getPars(r,"center").split(","),o=getPars(r,"markers").split(","),point=new BMap.Point(Number(n[0]),Number(n[1])),marker=new BMap.Marker(new BMap.Point(Number(o[0]),Number(o[1]))),map.addControl(new BMap.NavigationControl),map.centerAndZoom(point,Number(getPars(r,"zoom")))}else point=new BMap.Point(116.404,39.915),marker=new BMap.Marker(point),map.addControl(new BMap.NavigationControl),map.centerAndZoom(point,10);marker.enableDragging(),map.addOverlay(marker)}var map=new BMap.Map("container"),marker,point,styleStr;map.enableScrollWheelZoom(),map.enableContinuousZoom(),init(),document.getElementById("address").onkeydown=function(e){e=e||event,13==e.keyCode&&doSearch()},dialog.onok=function(){var e=map.getCenter(),t=map.zoomLevel,a=map.getSize(),r=a.width,n=a.height,o=marker.getPoint();if($G("is_dynamic").checked){var i=editor.options.UEDITOR_HOME_URL,m=[i+(/\/$/.test(i)?"":"/")+"dialogs/map/show.html#center="+e.lng+","+e.lat,"&zoom="+t,"&width="+r,"&height="+n,"&markers="+o.lng+","+o.lat,"&markerStyles=l,A"].join("");editor.execCommand("inserthtml",'<iframe class="ueditor_baidumap" src="'+m+'"'+(styleStr?' style="'+styleStr+'"':"")+' frameborder="0" width="'+(r+4)+'" height="'+(n+4)+'"></iframe>')}else{var m="http://api.map.baidu.com/staticimage?center="+e.lng+","+e.lat+"&zoom="+t+"&width="+a.width+"&height="+a.height+"&markers="+o.lng+","+o.lat;editor.execCommand("inserthtml",'<img width="'+a.width+'"height="'+a.height+'" src="'+m+'"'+(styleStr?' style="'+styleStr+'"':"")+"/>")}},document.getElementById("address").focus();</script></body></html>